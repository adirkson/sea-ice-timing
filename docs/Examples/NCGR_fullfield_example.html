
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Performing NCGR on a full forecast field &#8212; sea-ice-timing 1.0.2 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Performing NCGR at a gridpoint" href="NCGR_gridpoint_example.html" />
    <link rel="prev" title="NCGR" href="../index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Performing-NCGR-on-a-full-forecast-field">
<h1>Performing NCGR on a full forecast field<a class="headerlink" href="#Performing-NCGR-on-a-full-forecast-field" title="Permalink to this headline">¶</a></h1>
<p>This notebook walks you through how to use the <code class="docutils literal notranslate"><span class="pre">NCGR</span></code> package to perform non-homogenous Gaussian regression (NCGR) on a full field of ice-free date or freeze-up date forecasts using the <code class="docutils literal notranslate"><span class="pre">NCGR.ncgr_fullfield</span></code> module. For this specific example, we’ll be calibrating a freeze-up date forecast. This option is <strong>plug-and-play</strong>, and allows the user to provide a forecast, training hindcasts, and training observations in NetCDF files. An output netCDF file is produced that contains a calibrated
probabilistic ice-free date/freeze-up date forecast.</p>
<div class="section" id="Outline">
<h2>Outline<a class="headerlink" href="#Outline" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>The first section of this notebook, <strong>Working Script</strong>, offers a copy and pasteable section of code that performs NCGR on a forecast ice-free date or freeze-up date field.</p></li>
<li><p>The second section section of the notebook, <strong>Detailed explanation</strong>, goes through step-by-step and provides insights on each piece of code.</p></li>
<li><p>The third section of the notebook, <strong>Plotting</strong>, shows how to load the output NetCDF file created in the previous section (it’s pre-made so you don’t have to run the previous section), and create a figure showing a three-category forecast for early, near-normal, and late ice-free date/freeze-up date forecast.</p></li>
</ul>
<p><em>Hint: You can hold “shift+tab” inside the parenthesis of any function in the notebook to see its help/docstring.</em></p>
</div>
<div class="section" id="Working-Script">
<h2>Working Script<a class="headerlink" href="#Working-Script" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">NCGR</span> <span class="kn">import</span> <span class="n">ncgr</span><span class="p">,</span> <span class="n">sitdates</span>

<span class="c1"># input filenames</span>
<span class="n">hc_netcdf</span> <span class="o">=</span> <span class="s1">&#39;./Data/fud_hc_1981_2019_im10.nc&#39;</span>
<span class="n">obs_netcdf</span> <span class="o">=</span> <span class="s1">&#39;./Data/fud_obs_1981_2019_im10.nc&#39;</span>
<span class="n">fcst_netcdf</span> <span class="o">=</span> <span class="s1">&#39;./Data/fud_fcst_2020_im10.nc&#39;</span>
<span class="n">clim_netcdf</span> <span class="o">=</span> <span class="s1">&#39;./Data/fud_clim_2011_2019_im10.nc&#39;</span>

<span class="c1"># output filename (this usually doesn&#39;t exist yet)</span>
<span class="n">out_netcdf</span> <span class="o">=</span> <span class="s1">&#39;./Data/fud_fcst_ncgr_2020_im10.nc&#39;</span>

<span class="c1"># Dictionary defining the relevant variables/dimensions for hc_netcdf and fcst_netcdf</span>
<span class="n">model_dict</span> <span class="o">=</span> <span class="p">({</span><span class="s1">&#39;event_vn&#39;</span> <span class="p">:</span> <span class="s1">&#39;fud&#39;</span><span class="p">,</span> <span class="c1"># variable name for the ice-free date or freeze-up date variable</span>
                   <span class="s1">&#39;time_vn&#39;</span> <span class="p">:</span> <span class="s1">&#39;time&#39;</span><span class="p">},</span> <span class="c1"># variable name for the time coordinate</span>
                  <span class="p">{</span><span class="s1">&#39;time_dn&#39;</span> <span class="p">:</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="c1"># dimension name for the time coordinate</span>
                   <span class="s1">&#39;ens_dn&#39;</span> <span class="p">:</span> <span class="s1">&#39;ensemble&#39;</span><span class="p">})</span> <span class="c1"># dimension name for the forecast realization coordinate</span>

<span class="c1"># Dictionary defining the relevant variables/dimensions for obs_netcdf</span>
<span class="n">obs_dict</span> <span class="o">=</span> <span class="p">({</span><span class="s1">&#39;event_vn&#39;</span> <span class="p">:</span> <span class="s1">&#39;fud&#39;</span><span class="p">,</span>  <span class="c1"># variable name for the ice-free date or freeze-up date variable</span>
                 <span class="s1">&#39;time_vn&#39;</span> <span class="p">:</span> <span class="s1">&#39;time&#39;</span><span class="p">},</span> <span class="c1"># variable name for the time coordinate</span>
                <span class="p">{</span><span class="s1">&#39;time_dn&#39;</span> <span class="p">:</span> <span class="s1">&#39;time&#39;</span><span class="p">})</span> <span class="c1"># dimension name for the time coordinate</span>

<span class="n">im</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># initialization month</span>
<span class="n">si_time</span> <span class="o">=</span> <span class="n">sitdates</span><span class="o">.</span><span class="n">sitdates</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="s1">&#39;fud&#39;</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">si_time</span><span class="o">.</span><span class="n">get_min</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">si_time</span><span class="o">.</span><span class="n">get_max</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>

<span class="c1"># calibrate</span>
<span class="n">ncgr</span><span class="o">.</span><span class="n">ncgr_fullfield</span><span class="p">(</span><span class="n">fcst_netcdf</span><span class="p">,</span> <span class="n">hc_netcdf</span><span class="p">,</span> <span class="n">obs_netcdf</span><span class="p">,</span> <span class="n">out_netcdf</span><span class="p">,</span>
                  <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">model_dict</span><span class="p">,</span> <span class="n">obs_dict</span><span class="p">,</span>
                  <span class="n">clim_netcdf</span><span class="o">=</span><span class="n">clim_netcdf</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Detailed-explanation">
<h2>Detailed explanation<a class="headerlink" href="#Detailed-explanation" title="Permalink to this headline">¶</a></h2>
<p>Import necessary modules and create a variable for the event of interest (can be either <code class="docutils literal notranslate"><span class="pre">event='fud'</span></code> or <code class="docutils literal notranslate"><span class="pre">event='ifd'</span></code>):</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">NCGR</span> <span class="kn">import</span> <span class="n">ncgr</span><span class="p">,</span> <span class="n">sitdates</span>
<span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="kn">import</span> <span class="nn">netCDF4</span> <span class="k">as</span> <span class="nn">nc4</span>

<span class="n">event</span> <span class="o">=</span> <span class="s1">&#39;fud&#39;</span>
</pre></div>
</div>
</div>
<p>We’ll now define a string-type variable for each of the NetCDF files (path+filename) to be used as inputs to <code class="docutils literal notranslate"><span class="pre">ncgr.ncgr_fullfield()</span></code>. Details on these files are given below.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fcst_netcdf</span> <span class="o">=</span> <span class="s1">&#39;./Data/fud_fcst_2020_im10.nc&#39;</span> <span class="c1"># forecast to calibrate</span>
<span class="n">hc_netcdf</span> <span class="o">=</span> <span class="s1">&#39;./Data/fud_hc_1981_2019_im10.nc&#39;</span> <span class="c1"># training forecasts/hindcasts</span>
<span class="n">obs_netcdf</span> <span class="o">=</span> <span class="s1">&#39;./Data/fud_obs_1981_2019_im10.nc&#39;</span> <span class="c1"># training observations</span>
<span class="n">clim_netcdf</span> <span class="o">=</span> <span class="s1">&#39;./Data/fud_clim_2011_2019_im10.nc&#39;</span> <span class="c1"># observations for definining climatology</span>
</pre></div>
</div>
</div>
<div class="section" id="Details-of-input-NetCDF-files">
<h3>Details of input NetCDF files<a class="headerlink" href="#Details-of-input-NetCDF-files" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>All of the files must have the same spatial coordinates.</p></li>
<li><p>The time-like variable in each file must be CF compliant.</p></li>
<li><p>The files contain ice-free dates or freeze-up dates, not daily ice concentration values. Thus, it is up to the user to compute those dates and create these files before using <code class="docutils literal notranslate"><span class="pre">NCGR</span></code>.</p></li>
</ul>
<div class="section" id="fcst_netcdf">
<h4>fcst_netcdf<a class="headerlink" href="#fcst_netcdf" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Must contain a variable with the name ‘ifd’ or ‘fud’, containing the ice-free date (if ‘ifd’) or freeze-up date (if ‘fud’) forecast to be calibrated. The values should be in day-of-year format (e.g. 1=Jan. 1, 273=Sep. 31, 365=Dec. 31).</p></li>
<li><p>Dimensions of the {‘ifd’,‘fud’} variable must be (in plain language): <code class="docutils literal notranslate"><span class="pre">(time,</span> <span class="pre">ensemble,</span> <span class="pre">latitude,</span> <span class="pre">longitude)</span></code></p>
<ul>
<li><p>The actual dimension/variable names can be anything, and will be specified shortly using the <code class="docutils literal notranslate"><span class="pre">model_dict</span></code> variable.</p></li>
<li><p>The shape of the time dimension should be 1, and the corresponding variable should contain the start date of the forecast.</p></li>
</ul>
</li>
<li><p>Masked values are ignored in the input files and the output file created will contain masked value s in the same locations.</p></li>
</ul>
</div>
<div class="section" id="hc_netcdf">
<h4>hc_netcdf<a class="headerlink" href="#hc_netcdf" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Same as <code class="docutils literal notranslate"><span class="pre">fcst_netcdf</span></code>, except that the shape of the time variable should be :math:<code class="docutils literal notranslate"><span class="pre">N</span></code>, corresponding to the number of years in the hindcast record. The corresponding variable should contain the start dates of all the hindcasts used for training.</p></li>
</ul>
</div>
<div class="section" id="obs_netcdf">
<h4>obs_netcdf<a class="headerlink" href="#obs_netcdf" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Same as <code class="docutils literal notranslate"><span class="pre">hc_netcdf</span></code>, except that the dimensions of the {‘ifd’,‘fud’} variable must be (in plain language): <code class="docutils literal notranslate"><span class="pre">(time,</span> <span class="pre">latitude,</span> <span class="pre">longitude)</span></code> (i.e. the observed dates do not have an ensemble-like coordinate).</p></li>
</ul>
</div>
<div class="section" id="clim_netcdf">
<h4>clim_netcdf<a class="headerlink" href="#clim_netcdf" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Same as <code class="docutils literal notranslate"><span class="pre">obs_netcdf</span></code>, except that this file contains the observed ice-free or freeze-up dates to be used to define the climatology relative to which forecast probabilities are computed. For this example, <code class="docutils literal notranslate"><span class="pre">clim_netcdf</span></code> was created directly from <code class="docutils literal notranslate"><span class="pre">obs_netcdf</span></code> by selecting the last 10 years of observations to be used for the climatology.</p></li>
</ul>
<p>Next, we’ll define a string-type variable for the output NetCDF file (path+filename) to be created:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># output filename (this usually doesn&#39;t exist yet; if it does, it will be overwritten)</span>
<span class="n">out_netcdf</span> <span class="o">=</span> <span class="s1">&#39;./Data/fud_fcst_ncgr_2020_im10.nc&#39;</span>
</pre></div>
</div>
</div>
<p>Two dictionaries need to be created that define the relevant variable names and dimension names in the input NetCDF files. First, create a dictionary representing the relevant terms in the <code class="docutils literal notranslate"><span class="pre">fcst_netcdf</span></code> and <code class="docutils literal notranslate"><span class="pre">hc_netcdf</span></code> files. In practice, for your own NetCDF files, you would want to replace the entries to the right of each “:” with those in your NetCDF files.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model_dict</span> <span class="o">=</span> <span class="p">({</span><span class="s1">&#39;event_vn&#39;</span> <span class="p">:</span> <span class="n">event</span><span class="p">,</span> <span class="c1"># variable name of the ice-free date or freeze-up date variable</span>
                   <span class="s1">&#39;time_vn&#39;</span> <span class="p">:</span> <span class="s1">&#39;time&#39;</span><span class="p">},</span> <span class="c1"># variable name of the time coordinate</span>
                  <span class="p">{</span><span class="s1">&#39;time_dn&#39;</span> <span class="p">:</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="c1"># dimension name of the time coordinate</span>
                   <span class="s1">&#39;ens_dn&#39;</span> <span class="p">:</span> <span class="s1">&#39;ensemble&#39;</span><span class="p">})</span> <span class="c1"># dimension name of the forecast realization/ensemble coordinate</span>
</pre></div>
</div>
</div>
<p>Second, create a dictionary representing the relevant terms in <code class="docutils literal notranslate"><span class="pre">obs_netcdf</span></code> and <code class="docutils literal notranslate"><span class="pre">clim_netcdf</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">obs_dict</span> <span class="o">=</span> <span class="p">({</span><span class="s1">&#39;event_vn&#39;</span> <span class="p">:</span> <span class="n">event</span><span class="p">,</span>  <span class="c1"># variable name for the ice-free date or freeze-up date variable</span>
                 <span class="s1">&#39;time_vn&#39;</span> <span class="p">:</span> <span class="s1">&#39;time&#39;</span><span class="p">},</span> <span class="c1"># variable name for the time coordinate</span>
                <span class="p">{</span><span class="s1">&#39;time_dn&#39;</span> <span class="p">:</span> <span class="s1">&#39;time&#39;</span><span class="p">})</span> <span class="c1"># dimension name for the time coordinate</span>
</pre></div>
</div>
</div>
<p>Now we’ll define the minimum and maximum dates possible</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Relevant variables for time</span>
<span class="n">im</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># initialization month</span>
<span class="n">si_time</span> <span class="o">=</span> <span class="n">sitdates</span><span class="o">.</span><span class="n">sitdates</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">)</span> <span class="c1"># instantiate sitdates class</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">si_time</span><span class="o">.</span><span class="n">get_min</span><span class="p">(</span><span class="n">im</span><span class="p">)</span> <span class="c1"># minimum date for the event</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">si_time</span><span class="o">.</span><span class="n">get_max</span><span class="p">(</span><span class="n">im</span><span class="p">)</span> <span class="c1"># maximum date for the event</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;minimum date (DOY and YYYY/MM/DD):&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">si_time</span><span class="o">.</span><span class="n">doy_to_date</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y/%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;maximum date (DOY and YYYY/MM/DD):&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">si_time</span><span class="o">.</span><span class="n">doy_to_date</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y/%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
minimum date (DOY and YYYY/MM/DD): (273, &#39;2014/10/01&#39;)
maximum date (DOY and YYYY/MM/DD): (455, &#39;2015/04/01&#39;)
</pre></div></div>
</div>
<p>In the above section of code, we’ve made use of the <code class="docutils literal notranslate"><span class="pre">sitdates</span></code> module by instantiating it with the event variable. By doing so, and by calling on <code class="docutils literal notranslate"><span class="pre">si_time.get_min()</span></code> and <code class="docutils literal notranslate"><span class="pre">si_time.get_max()</span></code> with the initialization month as an input argument, the minimum and maximum dates possible are returned. I’ve printed these out in day-of-year and YYYY/MM/DD format using the function <code class="docutils literal notranslate"><span class="pre">si_time.doy_to_date()</span></code>. Reading the documentation for <code class="docutils literal notranslate"><span class="pre">sitdates</span></code> you’ll see that default dates are set to those
given in [1].</p>
</div>
</div>
<div class="section" id="Useful-side-note:">
<h3><em>Useful side-note:</em><a class="headerlink" href="#Useful-side-note:" title="Permalink to this headline">¶</a></h3>
<p>If rather different conventions are used for your data, you can change the dates associated with <code class="docutils literal notranslate"><span class="pre">si_time.get_min()</span></code> and <code class="docutils literal notranslate"><span class="pre">si_time.get_max()</span></code> using <code class="docutils literal notranslate"><span class="pre">si_time.set_min()</span></code> and <code class="docutils literal notranslate"><span class="pre">si_time.set_max()</span></code>.</p>
<p>We now have everything we need to perform the calibration, which can be done with the following function call. I’ve commented this out so that it isn’t actually executed when running this full notebook (it takes about an hour).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#ncgr.ncgr_fullfield(fcst_netcdf, hc_netcdf, obs_netcdf, out_netcdf,</span>
<span class="c1">#                  a, b, model_dict, obs_dict,</span>
<span class="c1">#                  clim_netcdf=clim_netcdf)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Plotting">
<h2>Plotting<a class="headerlink" href="#Plotting" title="Permalink to this headline">¶</a></h2>
<p>An output file <code class="docutils literal notranslate"><span class="pre">./Data/fud_fcst_ncgr_2020_im10.nc</span></code> already exists that we’ll now load to plot the probabilistic forecast as a three category forecast.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">cartopy.feature</span> <span class="k">as</span> <span class="nn">cfeature</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>


<span class="c1">###############################################################################</span>
<span class="c1">################## User-defined variables #####################################</span>
<span class="c1">###############################################################################</span>

<span class="n">event</span> <span class="o">=</span> <span class="s1">&#39;fud&#39;</span>
<span class="n">tc</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="c1"># threshold SIC for the event (needed to apply observation mask)</span>

<span class="c1"># initialization month</span>
<span class="n">im</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">im_id</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%02d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">im</span>


<span class="c1"># Climatology years (for computing forecast anomalies and event probabilities;</span>
<span class="c1"># also just for creating filenames)</span>
<span class="n">clim_yr_s</span> <span class="o">=</span> <span class="mi">2011</span>
<span class="n">clim_yr_f</span> <span class="o">=</span> <span class="mi">2019</span>

<span class="c1"># Forecast year (also just for creating filenames)</span>
<span class="n">fcst_yr</span> <span class="o">=</span> <span class="mi">2020</span>

<span class="c1"># the directories where the data are located and where the produced figure will be saved</span>
<span class="n">dir_out</span> <span class="o">=</span> <span class="s1">&#39;./Data/&#39;</span>

<span class="c1"># path+filename of NCGR-calibrated forecast</span>
<span class="n">ncgr_netcdf</span> <span class="o">=</span> <span class="n">dir_out</span><span class="o">+</span><span class="n">event</span><span class="o">+</span><span class="s1">&#39;_fcst_ncgr_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">fcst_yr</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_im&#39;</span><span class="o">+</span><span class="n">im_id</span><span class="o">+</span><span class="s1">&#39;.nc&#39;</span>

<span class="c1"># load observed SIC for day prior to the initialization date</span>
<span class="c1"># this was obtained from https://nsidc.org/data/g10016 and interpolated onto the model grid.</span>
<span class="c1"># this is used to define the pre-occurrence of the event in the case that the forecast initialization</span>
<span class="c1"># does not accurately capture the event (e.g. due to discrepancies from assimilation)</span>
<span class="n">sic_obs</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">dir_out</span><span class="o">+</span><span class="s1">&#39;seaice_conc_daily_icdr_nh_f18_20200930_v01r00_rg.nc&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;seaice_conc_cdr&#39;</span><span class="p">][:][</span><span class="mi">0</span><span class="p">]</span>

<span class="c1">###########################</span>
<span class="n">ncgr_fcst_file</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">ncgr_netcdf</span><span class="p">)</span>
<span class="c1"># forecast probabilities for early, normal, late event</span>
<span class="n">ncgr_p_en</span> <span class="o">=</span> <span class="n">ncgr_fcst_file</span><span class="p">[</span><span class="s1">&#39;prob_EN&#39;</span><span class="p">][:][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ncgr_p_nn</span> <span class="o">=</span> <span class="n">ncgr_fcst_file</span><span class="p">[</span><span class="s1">&#39;prob_NN&#39;</span><span class="p">][:][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ncgr_p_ln</span> <span class="o">=</span> <span class="n">ncgr_fcst_file</span><span class="p">[</span><span class="s1">&#39;prob_LN&#39;</span><span class="p">][:][</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># climatological terciles</span>
<span class="n">clim_terc_low</span> <span class="o">=</span> <span class="n">ncgr_fcst_file</span><span class="p">[</span><span class="s1">&#39;clim_1_3&#39;</span><span class="p">][:][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">clim_terc_up</span> <span class="o">=</span> <span class="n">ncgr_fcst_file</span><span class="p">[</span><span class="s1">&#39;clim_2_3&#39;</span><span class="p">][:][</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># forecst probabilities for pre/non occurrence of the event</span>
<span class="n">fcst_pre</span> <span class="o">=</span> <span class="n">ncgr_fcst_file</span><span class="p">[</span><span class="s1">&#39;prob_pre&#39;</span><span class="p">][:][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">fcst_non</span> <span class="o">=</span> <span class="n">ncgr_fcst_file</span><span class="p">[</span><span class="s1">&#39;prob_non&#39;</span><span class="p">][:][</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># set masked values to nan</span>
<span class="n">fill_value</span> <span class="o">=</span> <span class="n">ncgr_fcst_file</span><span class="p">[</span><span class="s1">&#39;prob_EN&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_FillValue</span>
<span class="n">ncgr_p_en</span><span class="p">[</span><span class="n">ncgr_p_en</span><span class="o">==</span><span class="n">fill_value</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">ncgr_p_nn</span><span class="p">[</span><span class="n">ncgr_p_nn</span><span class="o">==</span><span class="n">fill_value</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">ncgr_p_ln</span><span class="p">[</span><span class="n">ncgr_p_ln</span><span class="o">==</span><span class="n">fill_value</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="c1"># load spatial variables and make 2d grid</span>
<span class="n">lat</span> <span class="o">=</span> <span class="n">ncgr_fcst_file</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">][:]</span>
<span class="n">lon</span> <span class="o">=</span> <span class="n">ncgr_fcst_file</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">][:]</span>
<span class="n">LON</span><span class="p">,</span> <span class="n">LAT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span><span class="n">lat</span><span class="p">)</span>

<span class="c1"># prep arrays to be filled with most likely category probability</span>
<span class="n">ncgr_p_en_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ncgr_p_en</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">ncgr_p_nn_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ncgr_p_nn</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">ncgr_p_ln_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ncgr_p_ln</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># if category is most likely, set to the probability for that category (else it will be zero)</span>
<span class="n">ncgr_p_en_new</span><span class="p">[</span><span class="n">ncgr_p_en</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ncgr_p_en</span><span class="p">,</span><span class="n">ncgr_p_nn</span><span class="p">,</span><span class="n">ncgr_p_ln</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ncgr_p_en</span><span class="p">[</span><span class="n">ncgr_p_en</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ncgr_p_en</span><span class="p">,</span><span class="n">ncgr_p_nn</span><span class="p">,</span><span class="n">ncgr_p_ln</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
<span class="n">ncgr_p_nn_new</span><span class="p">[</span><span class="n">ncgr_p_nn</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ncgr_p_en</span><span class="p">,</span><span class="n">ncgr_p_nn</span><span class="p">,</span><span class="n">ncgr_p_ln</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ncgr_p_nn</span><span class="p">[</span><span class="n">ncgr_p_nn</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ncgr_p_en</span><span class="p">,</span><span class="n">ncgr_p_nn</span><span class="p">,</span><span class="n">ncgr_p_ln</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
<span class="n">ncgr_p_ln_new</span><span class="p">[</span><span class="n">ncgr_p_ln</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ncgr_p_en</span><span class="p">,</span><span class="n">ncgr_p_nn</span><span class="p">,</span><span class="n">ncgr_p_ln</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ncgr_p_ln</span><span class="p">[</span><span class="n">ncgr_p_ln</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ncgr_p_en</span><span class="p">,</span><span class="n">ncgr_p_nn</span><span class="p">,</span><span class="n">ncgr_p_ln</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>

<span class="c1"># mask for when the climatological 2/3 tercile is equal to the last day of the forecast or season.</span>
<span class="n">clim_ut_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ncgr_p_nn_new</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">clim_ut_mask</span><span class="p">[(</span><span class="n">clim_terc_up</span><span class="o">==</span><span class="n">b</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">ncgr_p_nn_new</span><span class="o">&gt;</span><span class="mf">0.0</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="c1"># mask for white color in areas where the IFD (FUD) does not (has already) occur(red) at the end (start)</span>
<span class="c1"># of the forecast</span>
<span class="n">ice_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ncgr_p_nn_new</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">if</span> <span class="n">event</span><span class="o">==</span><span class="s1">&#39;ifd&#39;</span><span class="p">:</span>
    <span class="n">ice_mask</span><span class="p">[(</span><span class="n">fcst_non</span><span class="o">==</span><span class="mf">1.0</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">sic_obs</span><span class="o">&lt;</span><span class="n">tc</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="k">if</span> <span class="n">event</span><span class="o">==</span><span class="s1">&#39;fud&#39;</span><span class="p">:</span>
    <span class="n">ice_mask</span><span class="p">[(</span><span class="n">fcst_pre</span><span class="o">==</span><span class="mf">1.0</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">sic_obs</span><span class="o">&gt;</span><span class="n">tc</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="c1">########### Plotting  #####################</span>
<span class="c1"># useful function for the colorbar</span>
<span class="k">def</span> <span class="nf">truncate_colormap</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">minval</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">maxval</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="c1"># cuts off the ends of cmap colors at minval and maxval</span>
    <span class="n">new_cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span>
    <span class="s1">&#39;trunc(</span><span class="si">{n}</span><span class="s1">,</span><span class="si">{a:.2f}</span><span class="s1">,</span><span class="si">{b:.2f}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">cmap</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">minval</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">maxval</span><span class="p">),</span>
    <span class="n">cmap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">minval</span><span class="p">,</span> <span class="n">maxval</span><span class="p">,</span> <span class="n">n</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">new_cmap</span>

<span class="c1"># function for setting up Cartopy map</span>
<span class="k">def</span> <span class="nf">set_up_subplot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">subplot</span><span class="o">=</span><span class="mi">111</span><span class="p">):</span>
    <span class="n">crs_np</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">NorthPolarStereo</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=-</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">subplot</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="n">crs_np</span><span class="p">)</span>

    <span class="n">xll</span><span class="p">,</span> <span class="n">yll</span> <span class="o">=</span> <span class="n">crs_np</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="mf">279.26</span><span class="p">,</span><span class="mf">33.92</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Geodetic</span><span class="p">())</span>
    <span class="n">xur</span><span class="p">,</span> <span class="n">yur</span> <span class="o">=</span> <span class="n">crs_np</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="mf">102.34</span><span class="p">,</span><span class="mf">31.37</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Geodetic</span><span class="p">())</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="n">xll</span><span class="p">,</span><span class="n">xur</span><span class="p">,</span><span class="n">yll</span><span class="p">,</span><span class="n">yur</span><span class="p">],</span><span class="n">crs</span><span class="o">=</span><span class="n">crs_np</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">OCEAN</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;0.3&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAKES</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;110m&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span>

<span class="c1"># levels for each colorbar</span>
<span class="n">clevs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="n">clevs_lab</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;40&#39;</span><span class="p">,</span><span class="s1">&#39;60&#39;</span><span class="p">,</span><span class="s1">&#39;80&#39;</span><span class="p">,</span><span class="s1">&#39;100&#39;</span><span class="p">]</span>
<span class="n">clevs_lab</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="s1">&#39;%&#39;</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">clevs_lab</span><span class="p">]</span>
<span class="n">clevs_ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span>

<span class="c1"># colormaps for each category (note the color for early and late categories depends on the event)</span>
<span class="k">if</span> <span class="n">event</span><span class="o">==</span><span class="s1">&#39;fud&#39;</span><span class="p">:</span>
    <span class="n">cmap_ln</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">YlOrRd</span>
    <span class="n">cmap_nn</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">Greens</span>
    <span class="n">cmap_en</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">Blues</span>
<span class="k">if</span> <span class="n">event</span><span class="o">==</span><span class="s1">&#39;ifd&#39;</span><span class="p">:</span>
    <span class="n">cmap_en</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">YlOrRd</span>
    <span class="n">cmap_nn</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">Greens</span>
    <span class="n">cmap_ln</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">Blues</span>

<span class="n">cmap_en</span> <span class="o">=</span> <span class="n">truncate_colormap</span><span class="p">(</span><span class="n">cmap_en</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">cmap_nn</span> <span class="o">=</span> <span class="n">truncate_colormap</span><span class="p">(</span><span class="n">cmap_nn</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">cmap_ln</span> <span class="o">=</span> <span class="n">truncate_colormap</span><span class="p">(</span><span class="n">cmap_ln</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>

<span class="n">cmap_en</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="s1">&#39;0.75&#39;</span><span class="p">)</span>
<span class="n">cmap_nn</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="s1">&#39;0.75&#39;</span><span class="p">)</span>
<span class="n">cmap_ln</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="s1">&#39;0.75&#39;</span><span class="p">)</span>

<span class="n">cmap_en</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">YlOrRd</span><span class="p">(</span><span class="mi">256</span><span class="p">))</span>
<span class="n">cmap_nn</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">Greens</span><span class="p">(</span><span class="mi">256</span><span class="p">))</span>
<span class="n">cmap_ln</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">(</span><span class="mi">256</span><span class="p">))</span>

<span class="n">norm_en</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">clevs</span><span class="p">,</span> <span class="n">cmap_en</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
<span class="n">norm_nn</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">clevs</span><span class="p">,</span> <span class="n">cmap_nn</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
<span class="n">norm_ln</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">clevs</span><span class="p">,</span> <span class="n">cmap_ln</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>

<span class="c1">#############################################################</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">8.5</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">set_up_subplot</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

<span class="n">datain_masked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ice_mask</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">ice_mask</span><span class="o">==</span><span class="mf">0.0</span><span class="p">)</span>

<span class="n">masked_array1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ncgr_p_en_new</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">ncgr_p_en_new</span><span class="o">==</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">masked_array2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ncgr_p_nn_new</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">ncgr_p_nn_new</span><span class="o">==</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">masked_array3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ncgr_p_ln_new</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">ncgr_p_ln_new</span><span class="o">==</span><span class="mf">0.0</span><span class="p">)</span>


<span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">LON</span><span class="p">,</span><span class="n">LAT</span><span class="p">,</span><span class="n">datain_masked</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">Greys</span><span class="p">,</span>
              <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">im1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">LON</span><span class="p">,</span><span class="n">LAT</span><span class="p">,</span><span class="n">masked_array1</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
              <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_en</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm_en</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">im2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">LON</span><span class="p">,</span><span class="n">LAT</span><span class="p">,</span><span class="n">masked_array2</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
              <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_nn</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm_nn</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">im3</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">LON</span><span class="p">,</span><span class="n">LAT</span><span class="p">,</span><span class="n">masked_array3</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
              <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_ln</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm_ln</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>


<span class="c1">########### hatching for when the upper tercile for climatology includes the last day ############</span>
<span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Probability includes </span><span class="se">\n</span><span class="s1"> no &#39;</span><span class="o">+</span><span class="n">event</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="n">masked_array4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">clim_ut_mask</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">clim_ut_mask</span><span class="o">==</span><span class="mf">0.0</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;hatch.color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;hatch.linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">cs1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">LON</span><span class="p">,</span><span class="n">LAT</span><span class="p">,</span><span class="n">masked_array4</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;xxxxx&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
              <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

<span class="n">cs2</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="n">cs1</span><span class="o">.</span><span class="n">_hatch</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
<span class="n">l</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">[</span><span class="n">cs2</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">l</span><span class="o">.</span><span class="n">get_texts</span><span class="p">():</span>
    <span class="n">text</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>

<span class="c1">######### colorbars</span>
<span class="n">cbar_ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.035</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">])</span>
<span class="n">cb1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span><span class="n">cax</span><span class="o">=</span><span class="n">cbar_ax1</span><span class="p">,</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">clevs_ticks</span><span class="p">,</span>
             <span class="n">spacing</span><span class="o">=</span><span class="s1">&#39;uniform&#39;</span><span class="p">,</span> <span class="n">drawedges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">boundaries</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">clevs</span><span class="p">,</span> <span class="n">extendfrac</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">cbar_ax1</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">clevs_lab</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">cbar_ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.035</span><span class="p">,</span> <span class="mf">0.34</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">])</span>
<span class="n">cb2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im2</span><span class="p">,</span><span class="n">cax</span><span class="o">=</span><span class="n">cbar_ax2</span><span class="p">,</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">clevs_ticks</span><span class="p">,</span>
             <span class="n">spacing</span><span class="o">=</span><span class="s1">&#39;uniform&#39;</span><span class="p">,</span><span class="n">drawedges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">boundaries</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">clevs</span><span class="p">,</span> <span class="n">extendfrac</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">cbar_ax2</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">clevs_lab</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">cbar_ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.035</span><span class="p">,</span> <span class="mf">0.63</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">])</span>
<span class="n">cb3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im3</span><span class="p">,</span><span class="n">cax</span><span class="o">=</span><span class="n">cbar_ax3</span><span class="p">,</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">clevs_ticks</span><span class="p">,</span>
             <span class="n">spacing</span><span class="o">=</span><span class="s1">&#39;uniform&#39;</span><span class="p">,</span><span class="n">drawedges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">boundaries</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">clevs</span><span class="p">,</span>  <span class="n">extendfrac</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>

<span class="n">cbar_ax1</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">clevs_lab</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">cbar_ax2</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">clevs_lab</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">cbar_ax3</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">clevs_lab</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">cbar_ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Early&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;semibold&#39;</span><span class="p">)</span>
<span class="n">cbar_ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Near-normal&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;semibold&#39;</span><span class="p">)</span>
<span class="n">cbar_ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Late&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;semibold&#39;</span><span class="p">)</span>

<span class="n">cbar_ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">cbar_ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">cbar_ax3</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>


<span class="n">cb1</span><span class="o">.</span><span class="n">outline</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">cb1</span><span class="o">.</span><span class="n">outline</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">cb1</span><span class="o">.</span><span class="n">dividers</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">cb1</span><span class="o">.</span><span class="n">dividers</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>

<span class="n">cb2</span><span class="o">.</span><span class="n">outline</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">cb2</span><span class="o">.</span><span class="n">outline</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">cb2</span><span class="o">.</span><span class="n">dividers</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">cb2</span><span class="o">.</span><span class="n">dividers</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>

<span class="n">cb3</span><span class="o">.</span><span class="n">outline</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">cb3</span><span class="o">.</span><span class="n">outline</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">cb3</span><span class="o">.</span><span class="n">dividers</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">cb3</span><span class="o">.</span><span class="n">dividers</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.065</span><span class="p">,</span><span class="mf">0.06</span><span class="p">,</span><span class="s1">&#39;EC&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.065</span><span class="p">,</span><span class="mf">0.36</span><span class="p">,</span><span class="s1">&#39;EC&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.065</span><span class="p">,</span><span class="mf">0.65</span><span class="p">,</span><span class="s1">&#39;EC&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">outline_patch</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>


<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.98</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.91</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Probability for Early, Near-normal, or Late &#39;</span><span class="o">+</span><span class="n">event</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39; </span><span class="se">\n</span><span class="s1"> From &#39;</span><span class="o">+</span><span class="n">im_id</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">fcst_yr</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; (cf &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">clim_yr_s</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">clim_yr_f</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="mf">10.</span><span class="p">)</span>

<span class="c1">#plt.savefig(dir_out+&#39;/&#39;+event.upper()+&#39;_im&#39;+str(im)+&#39;_3category.png&#39;,dpi=700)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/arlan/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:44: RuntimeWarning: invalid value encountered in less
/home/arlan/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:44: RuntimeWarning: invalid value encountered in greater
/home/arlan/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:45: RuntimeWarning: invalid value encountered in less
/home/arlan/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:45: RuntimeWarning: invalid value encountered in greater
/home/arlan/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:46: RuntimeWarning: invalid value encountered in less
/home/arlan/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:46: RuntimeWarning: invalid value encountered in greater
/home/arlan/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:73: RuntimeWarning: All-NaN slice encountered
/home/arlan/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:74: RuntimeWarning: All-NaN slice encountered
/home/arlan/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:75: RuntimeWarning: All-NaN slice encountered
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;Probability for Early, Near-normal, or Late FUD \n From 10/2020 (cf 2011-2019)&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Examples_NCGR_fullfield_example_20_2.png" src="../_images/Examples_NCGR_fullfield_example_20_2.png" />
</div>
</div>
<p>A couple things about the plot: * The white area in the central Arctic is where the forecast is for a 100% chance of having already occurred at the time of initialization. If the plotting code above were applied to an ice-free date forecast, a white region would also exist in the central Arctic corresponding to where ice retreat is forecasted to not occur with 100% probability.</p>
<ul class="simple">
<li><p>The cyan area represents open ocean where no freeze-up has occured over the climatological record (i.e. the lower and upper terciles for the climatology are both equal to the date <code class="docutils literal notranslate"><span class="pre">a</span></code>.)</p></li>
<li><p>When the climatological upper tercile is equal to the last day of the season, by definition the “near-normal” category includes this date in its limits. To highlight these locations on the map, I’ve used hatching to indicate where the upper tercile includes the last day of the season.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">sea-ice-timing</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Performing NCGR on a full forecast field</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Performing NCGR on a full forecast field</a></li>
<li class="toctree-l1"><a class="reference internal" href="NCGR_gridpoint_example.html">Performing NCGR at a gridpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="DCNORM_distribution_example.html">Using the dcnorm module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../code_ncgr.html">NCGR</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../index.html" title="previous chapter">NCGR</a></li>
      <li>Next: <a href="NCGR_gridpoint_example.html" title="next chapter">Performing NCGR at a gridpoint</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Arlan Dirkson.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/Examples/NCGR_fullfield_example.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>